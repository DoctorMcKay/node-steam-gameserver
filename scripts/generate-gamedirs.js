var SteamGameServer = require('../index.js');

// Get this from https://steamdb.info/search/?a=app_keynames&type=1&keyname=64&operator=1&keyvalue=
var appids = [10,20,30,40,50,60,70,80,220,240,300,304,320,360,440,480,500,530,550,630,730,1002,1200,1210,1230,1250,1270,1280,1300,1309,1320,1900,2110,2130,2400,2410,2720,4000,4920,6510,10680,13120,13140,17500,17510,17520,17530,17550,17570,17580,17700,17710,17730,17740,21500,22350,24500,25700,28000,28050,33930,34030,34830,35130,35450,39000,41000,41010,41070,42120,42690,42830,57200,60700,63380,92000,96300,96800,107410,108600,201280,203290,205930,207230,208860,209120,211340,214190,219640,222880,223390,224260,225140,225220,225600,225840,227780,232090,236510,242760,243320,244030,244630,244850,245130,246820,246900,248630,251570,252490,253530,254200,259080,259570,263060,263440,263480,263920,265630,270450,280180,282440,282960,290080,293220,293760,300380,302830,304930,310760,314050,314710,317360,317940,318100,320790,321360,322330,323850,324810,328070,330460,331990,332500,332970,333950,334750,335430,339530,339790,344320,346110,346330,349480,350150,350220,360940,362890,364690,365960,366220,366440,367270,368180,368720,373110,373120,373720,376210,380570,383530,383790,384960,388800,391240,392060,393380,393420,393430,394600,394690,395200,397680,399580,407530,409510,409580,412450,416260,431600,434650,436260,447820,461410,463920,465780,467760,477180];
var numApps = appids.length;
var gamedirs = {};

console.log("Logging on");
var user = new SteamGameServer();
user.logOn({
	"appID": 440,
	"gameDirectory": "tf",
	"gameVersion": "3561198"
});

user.on('loggedOn', function() {
	console.log("Logged on to " + user.steamID.steam3());
	process();
});

function process() {
	var remaining = appids.length;
	if (remaining == 0) {
		console.log("Complete!");
		require('fs').writeFile('../resources/gamedirs.json', JSON.stringify(gamedirs, undefined, "\t"));
		user.logOff();
		return;
	}

	var complete = numApps - remaining;
	console.log("Progress: " + Math.round((complete / numApps) * 100) + "%");

	var appid = appids.splice(0, 1)[0];
	user.getServerList(`\\appid\\${appid}`, 1, (result) => {
		if (!result.length) {
			// no servers for this game I guess
			process();
			return;
		}

		gamedirs[appid] = result[0].gamedir;
		process();
	});
}
